<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>æ–‡ç« é–±è®€</title>
Â  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
Â  <link rel="stylesheet" href="/css/templates.css">
</head>
<body>
Â  <button id="darkToggle">ğŸŒ™ å¤œé–“æ¨¡å¼</button>
Â  <div class="container">
Â  Â  Â  Â  <nav id="toc-container">
Â  Â  Â  
Â  Â  Â  <button id="index">å›é¦–é </button>
Â  Â  Â  <h2>ç›®éŒ„</h2>
Â  Â  Â  <div id="toc"></div>
Â  Â  Â  
Â  Â  </nav>

Â  Â  Â  Â  <article id="content" class="markdown-body">
Â  Â  Â  è¼‰å…¥ä¸­...
Â  Â  </article>

Â  Â  Â  </div>

Â  <button id="backToTop" title="å›åˆ°é ‚éƒ¨">â¬† Top</button>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
Â  <script>
    // ** ã€ä¿®æ”¹ 1: è¨­ç½® Marked çš„è‡ªè¨‚ Rendererã€‘ **
    // è¦†å¯« marked çš„ç¨‹å¼ç¢¼å€å¡Šæ¸²æŸ“å™¨ï¼Œè®“ 'mermaid' èªè¨€è¼¸å‡º div æ¨™ç±¤
    const renderer = new marked.Renderer();
    const originalCodeRenderer = renderer.code; 

    renderer.code = function(code, language) {
        if (language === 'mermaid') {
            // é‡åˆ° mermaid èªè¨€ï¼Œè½‰æ›æˆ <div class="mermaid">
            return '<div class="mermaid">' + code + '</div>';
        }
        // å…¶ä»–èªè¨€å‰‡ä¿ç•™åŸæœ¬çš„æ¸²æŸ“æ–¹å¼
        return originalCodeRenderer.apply(this, arguments);
    };

    // å¥—ç”¨è‡ªè¨‚ Renderer
    marked.setOptions({ renderer: renderer });
    // ** ã€ä¿®æ”¹ 1 çµæŸã€‘ **
    
Â  Â  async function loadMarkdown() {
Â  Â  Â  const params = new URLSearchParams(window.location.search);
Â  Â  Â  const file = params.get('file');
Â  Â  Â  if (!file) return;
Â  Â  
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch("../" + file);
Â  Â  Â  Â  if (!res.ok) throw new Error("HTTP " + res.status);
Â  Â  Â  Â  const md = await res.text();
Â  Â  
Â  Â  Â  Â  // Markdown -> HTML
Â  Â  Â  Â  document.getElementById("content").innerHTML = marked.parse(md);
Â  Â  
Â  Â  Â  Â  // ç”Ÿæˆ TOCï¼ˆåªæŠ“ h1 å’Œ h2ï¼‰
Â  Â  Â  Â  const tocContainer = document.getElementById("toc");
Â  Â  Â  Â  const headers = document.querySelectorAll("#content h1, #content h2, #content h3");
Â  Â  Â  Â  let tocHtml = "<ul>";
Â  Â  
Â  Â  Â  Â  headers.forEach(h => {
Â  Â  Â  Â  Â  const id = h.textContent.replace(/\s+/g, "-");
Â  Â  Â  Â  Â  h.id = id;
Â  Â  
Â  Â  Â  Â  Â  if (h.tagName === "H2") {
Â  Â  Â  Â  Â  Â  tocHtml += `<li style="margin-left:15px">- <a href="#${id}">${h.textContent}</a></li>`;
Â  Â  Â  Â  Â  } else if (h.tagName === "H3") {
Â  Â  Â  Â  Â  Â  tocHtml += `<li style="margin-left:30px">-- <a href="#${id}">${h.textContent}</a></li>`;
Â  Â  Â  Â  Â  } else { // h1
Â  Â  Â  Â  Â  Â  tocHtml += `<li>â€¢ <a href="#${id}">${h.textContent}</a></li>`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  tocHtml += "</ul>";
Â  Â  Â  Â  tocContainer.innerHTML = tocHtml;
Â  Â  Â  Â  
        // ** ã€ä¿®æ”¹ 2: è§¸ç™¼ Mermaid æ¸²æŸ“ã€‘ **
        // ç¢ºä¿ DOM å…§å®¹å·²ç¶“æ›´æ–°ï¼Œç„¶å¾Œæ‰‹å‹•åˆå§‹åŒ– Mermaid
        // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨ mermaid.run æ˜¯ç‚ºäº†å…¼å®¹è¼ƒæ–°çš„ç‰ˆæœ¬
        await mermaid.run({
            nodes: document.querySelectorAll('.mermaid')
        });
        // ----------------------------------------

Â  Â  Â  } catch (err) {
Â  Â  Â  Â  document.getElementById("content").innerHTML = "âš ï¸ ç„¡æ³•è¼‰å…¥æ–‡ç« ï¼š" + err.message;
Â  Â  Â  }
Â  Â  }
Â  Â  loadMarkdown();
</script>

<script src="/scripts/utils_templates/DarkMode.js"></script>
<script src="/scripts/utils_templates/BackSomewhere.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js"></script>
<script>
    // ** ã€ä¿®æ”¹ 3: èª¿æ•´ Mermaid åˆå§‹åŒ–ã€‘ **
    // å°‡ startOnLoad: true æ”¹ç‚º falseï¼Œå› ç‚ºæˆ‘å€‘å·²ç¶“åœ¨ loadMarkdown è£¡æ‰‹å‹•å‘¼å«äº†
    // ç§»é™¤ä¸å¿…è¦çš„ mermaid.initï¼Œæ”¹ç”¨ mermaid.runï¼ˆåœ¨ loadMarkdown å…§ï¼‰
    // ç‚ºäº†å…¼å®¹ v8.14.0ï¼Œé€™è£¡ç¶­æŒ mermaid.initializeï¼Œä½†é—œé–‰è‡ªå‹•è¼‰å…¥ã€‚
Â  Â  mermaid.initialize({ startOnLoad: false });
    // ** ã€ä¿®æ”¹ 3 çµæŸã€‘ **
</script>


</body>
</html>